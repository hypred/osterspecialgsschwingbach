// Array mit den gültigen QR-Code-IDs
const validCodes = [
    "gewinner1", // Beispiel für einen gültigen QR-Code
    "gewinner2",
    "gewinner3",
    "gewinner4",
    "gewinner5"
];

// Funktion, die das Scannen mit der Kamera startet
function startScanning() {
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");
    const resultDiv = document.getElementById('result');

    // Kamera zugänglich machen
    navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
            video.srcObject = stream;
            video.setAttribute("playsinline", true); // Für iOS erforderlich
            video.play();
            scanQRCode(); // QR-Code scannen, sobald das Video läuft
        })
        .catch((err) => {
            resultDiv.innerText = "Kamera konnte nicht gestartet werden.";
            resultDiv.style.color = "red";
        });

    // Funktion zum Scannen des QR-Codes
    function scanQRCode() {
        // Canvas auf die gleiche Größe wie das Video setzen
        canvas.height = video.videoHeight;
        canvas.width = video.videoWidth;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // QR-Code mit jsQR analysieren
        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, canvas.width, canvas.height, {
            inversionAttempts: "dontInvert",
        });

        if (code) {
            const scannedCode = code.data;
            // Überprüfen, ob der QR-Code gültig ist
            if (validCodes.includes(scannedCode)) {
                resultDiv.innerText = "Herzlichen Glückwunsch, du hast gewonnen!";
                resultDiv.style.color = "green";
            } else {
                resultDiv.innerText = "Leider kein Gewinn, versuche es noch einmal!";
                resultDiv.style.color = "red";
            }
        }

        // Weiter scannen
        requestAnimationFrame(scanQRCode);
    }
}
